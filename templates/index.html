<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link type='image/x-icon' rel='shortcut icon' href="{{ url_for('static', filename='img/favicon.ico') }}" />
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Certificaciones</title>

    <!-- Bootstrap -->
    <link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet">
    <style>
        body {
            background: radial-gradient(circle at 67.6% 20.39%, rgba(255, 255, 255, 0.5), transparent 69%),
                radial-gradient(circle at 88.75% 28.67%, rgba(255, 255, 255, 0.5), transparent 60%),
                radial-gradient(circle at 13.33% 0.38%, #bedbf752, transparent 38%),
                radial-gradient(circle at 86.77% 1.6%, #bedbf752, transparent 39%),
                radial-gradient(circle at 81.09% 74.15%, rgba(255, 255, 255, 0.5), transparent 57%),
                radial-gradient(circle at 67.81% 96.71%, #bedbf752, transparent 36%),
                radial-gradient(circle at 50% 50%, #ffffff, #ffffff 100%);
            justify-content: center;
            align-items: center;
            flex-direction: column;
            font-family: 'Montserrat', sans-serif;
            height: 100vh;
            margin: 0;
        }
    </style>
</head>

<body>
    <div>
        {% include 'header.html' %}
    </div>


    <div class="container">
        <div class="text-right" style="margin: 10px;">
            <a href="{{ url_for('logout') }}" class="btn btn-danger">Cerrar Sesión</a>
        </div>
        <div class="row">
            <div class="col-md-2">
                <div class="form-group">
                    <select id="ubicaciones" class="form-control">
                        <option value="Bogota">Bogotá DC</option>
                        <option value="Departamentes">Departamantos</option>
                    </select>
                </div>
            </div>
        </div>
        <br><br>
        <div class="row">

            <form id="form1" name="form1" action="{{ url_for('index') }}" method="POST" enctype="multipart/form-data">

                <div class="col-md-6">
                    <div class="row">

                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Número de Documento</label>
                                <input type="text" class="form-control" name="nDocumento" id="nDocumento" />
                            </div>

                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Nombre Del Funcionario</label>
                                <h4>{{ nombre_usuario }}</h4>
                            </div>
                        </div>
                    </div>
                    <div class="row">

                        <input type="hidden" name="nOficio" id="nOficio" readonly />
                        <!-- *********************************** -->

                        <div class="col-md-6">
                            <div class="form-group">

                                <label>Tipo de Documento</label>
                                <select name="tipoDocumento" class="form-control" id="tipoDocumento">
                                    {% for tipoDoc in tipodocumento %}
                                    <option value="{{ tipoDoc[0] }}">{{ tipoDoc[1] }}</option>
                                    {% endfor %}
                                </select>
                                
                            </div>
                        </div>

                        <div class="col-md-6">

                            <div class="form-group">

                                <label>Motivo de autorización</label>
                                <select name="motivoAutorizacion" class="form-control" id="motivoAutorizacion">
                                    <option value="-1" selected="selected">Seleccione</option>
                                    {% for motivo in motivoautorizacion %}
                                    <option value="{{ motivo[0] }}">{{ motivo[1] }}</option>
                                    {% endfor %}
                                </select>

                            </div>

                        </div>
                    </div>

                    <label>Validación Documentos</label>
                    <div id="checkboxes">
                        <div class="row">
                            {% for doc in validaciondocumentos %}
                            <div class="col-md-6">
                                <label class="checkbox-inline">
                                    <input type="checkbox" name="vDoc" id="vDoc{{ doc[0] }}" value="{{ doc[0] }}">
                                    {{ doc[1] }}
                                </label>
                            </div>
                            {% endfor %}
                        </div>
                    </div>


                    <div class="form-group">
                        <label>Archivo Plano</label>
                        <textarea class="form-control" name="aPlano" id="aPlano" rows="2"></textarea>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Nombre</label>
                                <input type="text" name="nombreCompleto" class="form-control" id="nombreCompleto" />

                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Banco</label>
                                <select name="banco" class="form-control" id="banco">
                                    <option value="1" selected="selected">Seleccione</option>
                                    {% for banco in banco %}
                                    <option value="{{ banco[0] }}">{{ banco[1] }}</option>
                                    {% endfor %}
                                </select>

                            </div>
                        </div>
                    </div>
                    <div class="row">

                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Fecha Consignación </label>
                                <input type="date" name="dfecha" id="dFecha" class="form-control">

                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Valor de Consignación </label>
                                <input type="text" name="valorConsignacion" id="valorConsignacion" class="form-control">

                            </div>
                        </div>
                    </div>
                    <div class="row">

                        <div class="col-md-6">
                            <div class="form-group">

                                <label for="lTramite">Lugar del trámite</label>
                                <select name="lTramite" id="lTramite" class="form-control">
                                    <option value="-1" selected="selected">Seleccione</option>
                                    {% for dtos in departamentos %}
                                    <option value="{{ dtos[0] }}">{{ dtos[1] }}</option>
                                    {% endfor %}
                                </select>

                            </div>
                        </div>


                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="lLocalidad">Localidad Trámite</label>
                                <select name="lLocalidad" id="lLocalidad" class="form-control">
                                    <option value="-1" selected="selected">Seleccione</option>
                                    {% for loc in localidades %}
                                    <option value="{{ loc[0] }}">{{ loc[1] }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                    </div>


                    <div class="form-group">
                        <label>Observaciones </label>
                        <textarea class="form-control" name="observacion" id="observacion" rows="2"
                            class="form-control"></textarea>

                    </div>



                    <div class="form-group">
                        <label id="botonPdf">
                            <button type="submit" class="btn btn-danger" id="btnGuardar"
                                onclick="guardar();">Guardar</button>
                        </label>

                    </div>
            </form>
        </div>


        <div style="padding: 20px;">
            <h5>DF-GCR– <b id="txtOficio">[Número de Oficio]</b></h5>
            <h5 id="horaActual">Bogotá D.C. [Fecha y Hora]</h5>
            <p>Señor(a) <b>Delegados Departamentales de <span id="txtTramite">[Trámite]</span></b></p>
            <p><b>Ref: TRÁMITE DE DUPLICADO DE <span id="txtTipoDocumento">[Tipo de Documento]</span></b></p>
            <h6>FECHA DE GENERACIÓN DOCUMENTO: [Fecha Generación]</h6>
            <h6>FECHA DE CADUCIDAD DE ESTE DOCUMENTO: [Fecha Caducidad]</h6>
            <p>
                <small>
                    Respetados doctores. <br>
                    De manera atenta me permito informar que revisados los archivos planos <span id="particulaBanco">[Partícula Banco]</span> <b id="txtBanco">[Banco]</b> se verificó la siguiente consignación:
                </small>
            </p>
            <p>
                <small>
                    Por lo tanto, se certifica el ingreso de los recursos a la cuenta del FRR para el trámite de duplicado de <b id="txtTipoDocumento">[Tipo de Documento]</b> al ciudadano(a): <b id="txtNombre">[Nombre]</b> con cupo numérico: <b id="txtDocumento">[Número de Documento]</b>, el cual se presenta por <b id="txtMotivo">[Motivo]</b>, favor recibir la siguiente documentación <b id="txtValidacion">[Validación]</b>, y verificar en su correo electrónico el código único: <b id="txtCodigoUnico">[Código Único]</b> de autorización de validez del documento, generado en la coordinación de recaudos que se enviará a su correo inmediatamente se haya generado este documento. Cordialmente,
                </small>
            </p>
            <p>
                CARLOS ANDRÉS CONTRERAS GONZÁLEZ<br>
                Coordinador Control de Recaudos<br>
                Banco Popular<br>
                <i><b>Teléfono:</b> 589 2323 <b>Dirección:</b> Carrera 45 No 54 – 75 Piso 6 Bogotá D.C.</i>
            </p>
            <p class="firma" id="firma">[Firma]</p>
            <small><input type="hidden" name="ip" id="ip" value="172.23.11.96"></small>
        </div>

    </div>

    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.6.0/jspdf.umd.min.js"></script>


    <script>
        /*
        document.getElementById('form1').addEventListener('submit', async function(e) {
        e.preventDefault(); // Evitar el envío del formulario
        guardar();
    });

    async function guardar() {
        const botonPdf = document.getElementById('btnGuardar');
        botonPdf.disabled = true;
        botonPdf.textContent = 'Generando PDF...';

        const formData = new FormData(document.getElementById('form1'));

        try {
            // Envía los datos del formulario al servidor Flask
            const response = await fetch("{{ url_for('index') }}", {
                method: 'POST',
                body: formData
            });

            if (!response.ok) {
                throw new Error('Error en el guardado');
            }

            const result = await response.json();
            if (result.success) {
                // Generar el PDF después de guardar los datos
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF('p', 'pt', 'a4');
                const content = document.querySelector('.col-md-6'); // Selecciona el contenido a convertir en PDF

                const canvas = await html2canvas(content);
                const imgData = canvas.toDataURL('image/png');
                const imgWidth = 210; 
                const imgHeight = (canvas.height * imgWidth) / canvas.width;

                doc.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);
                doc.save('Certificado.pdf'); // Nombre del archivo descargado

                botonPdf.disabled = false;
                botonPdf.textContent = 'Guardar';
            } else {
                alert('Error al guardar');
            }
        } catch (error) {
            console.error('Error:', error);
        }
    }
*/



        $(document).ready(function () {
            // Deshabilitar todos los campos excepto el número de documento al cargar la página
            toggleFormFields(true);
            $("#nDocumento").prop('disabled', false);
            $("#ubicaciones").prop('disabled', false);

            // Evento al escribir en el campo de documento
            $('#nDocumento').keyup(function () {
                let documento = $(this).val();
                if (documento.length > 5) {

                    toggleFormFields(false);
                    configurarFormulario();  // Configurar el formulario cuando esté desbloqueado
                } else {

                    toggleFormFields(true);
                }
            });
        });

        // Función para habilitar o deshabilitar campos del formulario
        function toggleFormFields(disabled) {
            $("input").not("#nDocumento").prop('disabled', disabled);
            $("textarea").prop('disabled', disabled);
            $("select").prop('disabled', disabled);
            $("checkbox").prop('disabled', disabled);
            $("radio").prop('disabled', disabled);
        }
        // Configuración del formulario cuando está desbloqueado
        function configurarFormulario() {
            // Actualizar campo de texto dinámicamente según el valor ingresado
            $("#txtDocumento").text($("#nDocumento").val());
            $("input").prop('disabled', false);
            $("textarea").prop('disabled', false);
            $("select").prop('disabled', false);
            $("checkbox").prop('disabled', false);
            $("radio").prop('disabled', false);
            $("#nDocumento").prop('disabled', false);

            $('#nombreCompleto').keyup(function () {
                $("#txtNombre").text($(this).val());
            });

            $("#lTramite").change(function () {
                $("#txtTramite").text($("#lTramite option:selected").text());
            });

            $("#motivoAutorizacion").change(function () {
                $("#txtMotivo").text($("#motivoAutorizacion option:selected").text());
            });

            $("#tipoDocumento").change(function () {
                var str = $("#tipoDocumento option:selected").text();
                var valor = $(this).val();
                var consignacion;
                switch (valor) {
                    case '2': // CC
                        consignacion = 49350;
                        break;
                    case '3': // TI
                        consignacion = 48400;
                        break;
                    case '1': // RC
                        consignacion = 8000;
                        break;
                    case '4':
                        consignacion = 4500;
                        break;
                    default:
                        consignacion = 0;
                        break;
                }
                $('#txtTipoDocumento').text(str);
                $('#valorConsignacion').val(consignacion);
            });

            $("#banco").change(function () {
                var str = $("#banco option:selected").text();
                var valor = $(this).val();
                var particula = (valor == 1 || valor == 2) ? "del " : "de ";
                $('#particulaBanco').text(particula);
                $('#txtBanco').text(str);
            });

            $('#aPlano').keyup(function () {
                $("#txtPlano").text($(this).val());
            });

            // Checkboxes
            $("#checkboxes").change(function () {
                var favorite = [];
                $.each($("input[name='vDoc']:checked"), function () {
                    favorite.push($(this).val());
                });
                $("#txtValidacion").text(favorite.join(", "));
            });

            $("#madeBy").change(function () {
                var valor = $(this).val();
                if (!valor) {
                    $('#madeBy').css('border-color', 'red');
                    $('#btnExportar').prop('disabled', true);
                    $('#btnGuardar').prop('disabled', true);
                } else {
                    $('#madeBy').css('border-color', '');
                    $('#btnExportar').prop('disabled', false);
                    if (!$('#nOficio').val()) {
                        $('#btnGuardar').prop('disabled', false);
                    }
                }
            });
        }

        function ajustarTamanoFuente(element) {
            let fontSize = 16; // Tamaño inicial de la fuente en píxeles
            element.style.fontSize = `${fontSize}px`;

            // Ajustar el tamaño de la fuente si el texto supera el contenedor
            while (element.scrollHeight > element.offsetHeight && fontSize > 8) { // Limitar el tamaño mínimo de la fuente a 8px
                fontSize--;
                element.style.fontSize = `${fontSize}px`;
            }
        }

        function actualizarTextoPlano() {
            const txtPlano = document.getElementById("txtPlano");
            const texto = txtPlano.textContent || txtPlano.innerText;

            // Actualizar el contenido del elemento con el texto ingresado
            txtPlano.textContent = texto;

            // Ajustar el tamaño de la fuente para que el texto se ajuste al contenedor
            ajustarTamanoFuente(txtPlano);
        }

        // Configurar el evento para actualizar el texto y ajustar el tamaño de la fuente
        document.getElementById("aPlano").addEventListener("keyup", function () {
            const txtPlano = document.getElementById("txtPlano");
            txtPlano.textContent = this.value;
            actualizarTextoPlano();
        });

        function actualizarHora() {
            const ahora = new Date();
            const opciones = { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false };
            const fechaHora = ahora.toLocaleString('es-ES', opciones);
            document.getElementById('horaActual').textContent = `Bogotá D.C. ${fechaHora}`;
        }

        // Actualizar la hora al cargar la página
        actualizarHora();

        // Actualizar la hora cada segundo
        setInterval(actualizarHora, 1000);

        //Actualizacion lugar de tramite

    </script>
</body>

</html>